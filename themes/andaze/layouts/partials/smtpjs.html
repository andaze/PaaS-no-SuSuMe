{{ if (eq true .Params.isSmtpJs) }}
<script defer src="https://smtpjs.com/v3/smtp.js"></script>
<script defer>
    (function () {

        const forms = document.querySelectorAll("form.smtpjs-form");
        const secureToken = '{{- .Site.Params.smtpjs.secureToken | default false -}}';
        const adminMail = '{{- .Site.Params.smtpjs.adminMail | default false -}}';
        const bccMail = '{{- .Site.Params.smtpjs.bccMail | default false -}}';
        const fromMail = '{{- .Site.Params.smtpjs.fromMail | default false -}}';
        const subject = '{{- .Site.Params.smtpjs.subject -}}';
        const alertMessage = '{{- .Site.Params.smtpjs.confirmMessage.alert -}}';
        const bodyHeader = '{{- .Site.Params.smtpjs.confirmMessage.bodyHeader -}}';
        const bodyFooter = '{{- .Site.Params.smtpjs.confirmMessage.bodyFooter -}}';
        
        const alertMessage_download = '{{- .Site.Params.smtpjs.confirmMessage.alert_download -}}';
        const bodyHeader_download = '{{- .Site.Params.smtpjs.confirmMessage.bodyHeader_download -}}';
        const bodyFooter_download = '{{- .Site.Params.smtpjs.confirmMessage.bodyFooter_download -}}';

        forms.forEach(function (form) {
            form.addEventListener("submit", function (e) {
                e.preventDefault();
                const data = new FormData(form);
                let toEmail = '';
                let bodyMain = '<br/>';
                for (const [name, value] of data) {
                    if (name == 'email') {
                        toEmail = value;
                    }else{
                        bodyMain = bodyMain.concat(name, " : <br/>", value, "<br/><br/>");
                    }
                }
                if (form.classList.contains('download')) {
                    submitted(toEmail, `${bodyHeader_download}<br/>${bodyMain}<br/>${bodyFooter_download}`, alertMessage_download);
                } else {
                    submitted(toEmail, `${bodyHeader}<br/>${bodyMain}<br/>${bodyFooter}`, alertMessage);
                }
            })
        });

        function submitted(to_email, body, dialog_message) {
            const email = Email.send({
                SecureToken: secureToken,
                To: to_email,
                From: fromMail,
                Bcc: bccMail,
                Subject: subject,
                Body: body,
            }).then(
                message => {
                    alert(dialog_message)
                }
            );
        }

    })();
</script>
{{ end }}